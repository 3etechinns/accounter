<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
                "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="com.vimukti.accounter.core"
	default-access="field" auto-import="false">

	<class name="Employee" table="EMPLOYEE">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="createdBy" column="CREATED_BY" class="User"
			not-null="true"></many-to-one>
		<many-to-one name="lastModifier" column="LAST_MODIFIER"
			class="User" not-null="true"></many-to-one>
		<property name="createdDate" column="CREATED_DATE" not-null="true" />
		<property name="lastModifiedDate" column="LAST_MODIFIED_DATE"
			not-null="true" />
		<many-to-one name="payStructure" column="PAY_STRUCTURE"
			class="PayStructure" />
		<property name="name" column="NAME" />
		<property name="number" column="NUMBER" />
		<many-to-one name="group" column="EMPLOYEE_GROUP" class="EmployeeGroup" />
		<many-to-one name="category" column="CATEGORY" class="EmployeeCategory" />
		<property name="dateofJoining" column="DATE_OF_JOINING"
			type="com.vimukti.accounter.core.LongUseType" />
		<property name="gender" column="GENDER" />
		<property name="contactNumber" column="CONTACT_NUMBER" />
		<property name="email" column="EMAIL" />
		<property name="bankName" column="BANK_NAME" />
		<property name="bankAccountNumber" column="BANK_ACCOUNT_NUMBER" />
		<property name="branch" column="BANK_BRANCH" />
		<property name="passportNumber" column="PASSPORT_NUMBER" />
		<property name="countryOfIssue" column="COUNTRY_OF_ISSUE" />
		<property name="passportExpiryDate" column="PASSPORT_EXPIRY_DATE"
			type="com.vimukti.accounter.core.LongUseType" />
		<property name="visaNumber" column="VISA_NUMBER" />
		<property name="visaExpiryDate" column="VISA_EXPIRY_DATE"
			type="com.vimukti.accounter.core.LongUseType" />
		<set name="customFieldValues" inverse="true" cascade="save-update,delete">
			<key column="COMPANY_ID" />
			<one-to-many class="CustomFieldValue" />
		</set>
		<component name="address" class="Address">
			<property name="type" column="ADDRESS_TYPE" />
			<property name="address1" column="ADDRESS_ADDRESS1" />
			<property name="street" column="ADDRESS_STREET" />
			<property name="city" column="ADDRESS_CITY" />
			<property name="stateOrProvinence" column="ADDRESS_STATE" />
			<property name="zipOrPostalCode" column="ADDRESS_ZIP" />
			<property name="countryOrRegion" column="ADDRESS_COUNTRY" />
			<property name="isSelected" column="ADDRESS_IS_SELECTED" />
		</component>

		<component name="contact" class="Contact">
			<property name="isPrimary" column="IS_PRIMARY" not-null="true" />
			<property name="name" column="CONTACT_NAME" not-null="true"
				length="100" />
			<property name="title" column="TITLE" not-null="true"
				length="100" />
			<property name="businessPhone" column="BUSINESS_PHONE"
				not-null="true" length="100" />
			<property name="email" column="CONTACT_EMAIL" not-null="true" />
		</component>

	</class>

	<class name="EmployeeGroup" table="EMPLOYEE_GROUP">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="createdBy" column="CREATED_BY" class="User"
			not-null="true"></many-to-one>
		<many-to-one name="lastModifier" column="LAST_MODIFIER"
			class="User" not-null="true"></many-to-one>
		<property name="createdDate" column="CREATED_DATE" not-null="true" />
		<property name="lastModifiedDate" column="LAST_MODIFIED_DATE"
			not-null="true" />
		<property name="name" column="NAME" />
		<many-to-one name="payStructure" column="PAY_STRUCTURE"
			class="PayStructure" />
		<list name="employees">
			<key column="EMPLOYEE_GROUP" />
			<list-index column="IDX" />
			<one-to-many class="Employee" />
		</list>

	</class>

	<class name="PayrollUnit" table="PAY_ROLL_UNIT">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="createdBy" column="CREATED_BY" class="User"
			not-null="true"></many-to-one>
		<many-to-one name="lastModifier" column="LAST_MODIFIER"
			class="User" not-null="true"></many-to-one>
		<property name="createdDate" column="CREATED_DATE" not-null="true" />
		<property name="lastModifiedDate" column="LAST_MODIFIED_DATE"
			not-null="true" />

		<property name="symbol" column="SYMBOL" />
		<property name="formalname" column="FORMAL_NAME" />
		<property name="noofDecimalPlaces" column="NO_OF_DECIMAL_PLACES" />

	</class>

	<class name="PayStructure" table="PAY_STRUCTURE">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="createdBy" column="CREATED_BY" class="User"
			not-null="true"></many-to-one>
		<many-to-one name="lastModifier" column="LAST_MODIFIER"
			class="User" not-null="true"></many-to-one>
		<property name="createdDate" column="CREATED_DATE" not-null="true" />
		<property name="lastModifiedDate" column="LAST_MODIFIED_DATE"
			not-null="true" />
		<many-to-one name="employee" column="EMPLOYEE" class="Employee">
		</many-to-one>
		<many-to-one name="employeeGroup" column="EMPLOYEE_GROUP"
			class="EmployeeGroup">
		</many-to-one>
		<property name="effectiveFrom" column="EFFECTIVE_FROM"
			type="com.vimukti.accounter.core.LongUseType" />
		<list name="items" cascade="save-update,delete">
			<key column="PAY_STRUCTURE" />
			<list-index column="IDX" />
			<one-to-many class="PayStructureItem" />
		</list>

	</class>

	<class name="PayStructureItem" table="PAY_STRUCTURE_ITEM">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company" />
		<many-to-one name="createdBy" column="CREATED_BY" class="User"
			not-null="true"></many-to-one>
		<many-to-one name="lastModifier" column="LAST_MODIFIER"
			class="User" not-null="true"></many-to-one>
		<property name="createdDate" column="CREATED_DATE" not-null="true" />
		<property name="lastModifiedDate" column="LAST_MODIFIED_DATE"
			not-null="true" />
		<many-to-one name="payStructure" column="PAY_STRUCTURE"
			class="PayStructure" />
		<many-to-one name="payHead" column="PAY_HEAD" class="PayHead" />
		<property name="rate" column="RATE" />
	</class>

	<class name="PayHead" table="PAY_HEAD">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="createdBy" column="CREATED_BY" class="User"
			not-null="true"></many-to-one>
		<many-to-one name="lastModifier" column="LAST_MODIFIER"
			class="User" not-null="true"></many-to-one>
		<property name="createdDate" column="CREATED_DATE" not-null="true" />
		<property name="lastModifiedDate" column="LAST_MODIFIED_DATE"
			not-null="true" />

		<property name="name" column="NAME" not-null="true" />
		<property name="type" column="TYPE" />
		<property name="nameToAppearInPaySlip" column="NAME_TO_APPEAR_ON_PAYSLIP" />
		<property name="calculationType" column="CALCULATION_TYPE" />
		<property name="isAffectNetSalary" column="IS_AFFECT_NET_SALARY" />
		<many-to-one name="account" column="ACCOUNT" class="Account" />

		<joined-subclass name="AttendancePayHead" table="ATTENDANCE_PAYHEAD">
			<key column="ID" />
			<property name="calculationPeriod" column="CALCULATION_PERIOD" />
			<property name="perDayCalculationBasis" column="PER_DAY_CALCULATION_BASIS" />
			<many-to-one name="leaveWithPay" column="LEAVE_WITH_PAY"
				class="AttendanceOrProductionType" />
			<many-to-one name="leaveWithoutPay" column="LEAVE_WITHOUT_PAY"
				class="AttendanceOrProductionType" />
			<many-to-one name="userDefinedCalendar" column="USER_DEFINED_CALENDAR"
				class="AttendanceOrProductionType" />
		</joined-subclass>

		<joined-subclass name="ComputionPayHead" table="COMPUTATION_PAY_HEAD">
			<key column="ID" />
			<property name="computationType" column="COMPUTATION_TYPE" />
			<property name="calculationPeriod" column="CALCULATION_PERIOD" />
			<list name="slabs" table="COMPUTATION_SLABS">
				<key column="PAY_HEAD_ID" not-null="true" />
				<list-index column="SLAB_INDEX" />
				<composite-element class="ComputationSlab">
					<property name="effectiveFrom" column="EFFECTIVE_FROM"
						type="com.vimukti.accounter.core.LongUseType" />
					<property name="fromAmount" column="FROM_AMOUNT" />
					<property name="toAmount" column="TO_AMOUNT" />
					<property name="slabType" column="SLAB_TYPE" />
					<property name="value" column="VALUE" />
				</composite-element>
			</list>
			<list name="formulaFunctions" table="FORMULA_FUNCTION">
				<key column="PAY_HEAD_ID" not-null="true" />
				<list-index column="FUNCTION_INDEX" />
				<composite-element class="ComputaionFormulaFunction">
					<property name="functionType" column="FUNCION_TYPE" />
					<many-to-one name="payHead" column="PAY_HEAD" class="PayHead" />
					<many-to-one name="attendanceType" column="ATTENDANCE_TYPE"
						class="AttendanceOrProductionType" />
				</composite-element>
			</list>
		</joined-subclass>

		<joined-subclass name="FlatRatePayHead" table="FLAT_RATE_PAY_HEAD">
			<key column="ID" />
			<property name="calculationPeriod" column="CALCULATION_PERIOD" />
		</joined-subclass>

		<joined-subclass name="ProductionPayHead" table="PRODUCTION_PAY_HEAD">
			<key column="ID" />
			<many-to-one name="productionType" column="PRODUCTION_TYPE"
				class="AttendanceOrProductionType" />
		</joined-subclass>

		<joined-subclass name="UserDefinedPayHead" table="USER_DEFINED_PAY_HEAD">
			<key column="ID" />

		</joined-subclass>
	</class>

	<class name="AttendanceOrProductionType" table="ATTENDANCE_OR_PRODUCTION_TPE">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<property name="type" column="TYPE" />
		<property name="name" column="NAME" />
		<many-to-one name="unit" column="UNIT" class="PayrollUnit" />
		<property name="periodType" column="PERIOD_TYPE" />
		<many-to-one name="createdBy" column="CREATED_BY" class="User"
			not-null="true" />
		<many-to-one name="lastModifier" column="LAST_MODIFIER"
			class="User" not-null="true" />
		<property name="createdDate" column="CREATED_DATE" not-null="true" />
		<property name="lastModifiedDate" column="LAST_MODIFIED_DATE"
			not-null="true" />
	</class>


	<class name="EmployeeCategory" table="EMPLOYEE_CATEGORY">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="createdBy" column="CREATED_BY" class="User"
			not-null="true"></many-to-one>
		<many-to-one name="lastModifier" column="LAST_MODIFIER"
			class="User" not-null="true"></many-to-one>
		<property name="createdDate" column="CREATED_DATE" not-null="true" />
		<property name="lastModifiedDate" column="LAST_MODIFIED_DATE"
			not-null="true" />

		<property name="name" column="NAME" />
	</class>

	<class name="EmployeePayHeadComponent" table="EMPLOYEE_PAYHEAD_COMPONENT">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="payHead" column="PAY_HEAD" class="PayHead">
		</many-to-one>
		<property name="rate" column="RATE" />
	</class>

	<class name="EmployeePaymentDetails" table="EMPLOYEE_PAYHEAD_COMPONENT">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="payRun" column="PAY_RUN" class="PayRun">
		</many-to-one>
		<many-to-one name="employee" column="EMPLOYEE" class="Employee">
		</many-to-one>
		<set name="payHeadComponents" inverse="true" cascade="save-update,delete">
			<key column="PAYHEAD_COMPONENT_ID" />
			<one-to-many class="EmployeePayHeadComponent" />
		</set>
	</class>

	<class name="PayRun" table="PAY_RUN">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="payableAccount" column="PAYABLE_ACCOUNT"
			class="Account">
		</many-to-one>
		<property name="payPeriodStartDate" column="PAY_PERIOD_STARTDATE"
			type="com.vimukti.accounter.core.LongUseType" />
		<property name="payPeriodEndDate" column="PAY_PERIOD_ENDDATE"
			type="com.vimukti.accounter.core.LongUseType" />
		<set name="payEmployee" inverse="true" cascade="save-update,delete">
			<key column="EMPLOYEE_PAYMENT_ID" />
			<one-to-many class="EmployeePaymentDetails" />
		</set>
	</class>

	<class name="AttendanceManagement" table="ATTENDANCE_MANAGEMENT">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<list name="items" cascade="save-update,delete">
			<key column="ATTENDANCE_MANAGEMENT" />
			<list-index column="IDX" />
			<one-to-many class="AttendanceManagementItem" />
		</list>
	</class>

	<class name="AttendanceManagementItem" table="ATTENDANCE_MANAGEMENT_ITEM">
		<id name="id" column="ID">
			<generator class="identity" />
		</id>
		<many-to-one name="company" column="COMPANY_ID" class="Company">
		</many-to-one>
		<many-to-one name="employee" column="EMPLOYEE" class="Employee">
		</many-to-one>
		<many-to-one name="attendanceType" column="ATTENDANCE_TYPE"
			class="AttendanceOrProductionType">
		</many-to-one>
		<property name="value" column="VALUE" />
	</class>

	<sql-query name="EmployeeAttendanceCurrentBal">
		<query-param name="company" type="long" />
		<query-param name="employee" type="long" />
		<query-param name="attendanceType" type="long" />

		<return-scalar column="VAL" type="long" />
		<![CDATA[
			SELECT SUM(I.VALUE) AS VAL FROM
					ATTENDANCE_MANAGEMENT_ITEM I
					
					WHERE I.COMPANY_ID = :company
						  AND I.EMPLOYEE = :employee
						  AND I.ATTENDANCE_TYPE = :attendanceType
		]]>
	</sql-query>


	<query name="list.All.Employees">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.Employee e where
		e.company=:company
		order by e.id
	</query>

	<query name="list.All.Payheads">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.PayHead ph where
		ph.company=:company
		order by ph.id
	</query>

	<query name="list.All.PayrollUnits">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.PayrollUnit pr where
		pr.company=:company
		order by pr.id
	</query>

	<query name="list.Payhead">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.PayHead ph where
		ph.company=:company
		order by ph.id
	</query>

	<query name="list.PayrollUnit">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.PayrollUnit p where p.company=:company
	</query>

	<query name="list.PayStructure">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.PayStructure p where
		p.company=:company
	</query>

	<query name="list.AttendanceProductionType">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.AttendanceOrProductionType p where
		p.company=:company
	</query>

	<query name="list.EmployeeGroups">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.EmployeeGroup eg where
		eg.company=:company
	</query>

	<query name="list.EmployeeCategories">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.EmployeeCategory ec where
		ec.company=:company
	</query>

	<query name="getEmployee.by.Name">
		<query-param name="company" type="Company" />
		<query-param name="name" type="String" />
		from com.vimukti.accounter.core.Employee E where
		E.company=:company and
		E.name=:name
	</query>

	<query name="getPayhead.by.Name">
		<query-param name="company" type="Company" />
		<query-param name="name" type="String" />
		<query-param name="id" type="long" />
		from com.vimukti.accounter.core.PayHead PH where
		PH.company=:company
		and
		PH.name=:name and PH.id !=:id
	</query>

	<query name="getPayStructureItem.by.employee">
		<query-param name="company" type="Company" />
		<query-param name="id" type="long" />
		from com.vimukti.accounter.core.PayStructureItem PI
		where PI.payStructure.employee.id = :id or
		PI.payStructure.employeeGroup.id =
		:id
		and PI.company = :company
		order by PI.rate desc
	</query>
	<query name="getAttendanceMItem.by.employee">
		<query-param name="employee" type="Employee" />
		<query-param name="attendanceType" type="AttendanceOrProductionType" />
		from com.vimukti.accounter.core.AttendanceManagementItem ami
		where ami.employee = :employee and ami.attendanceType =:attendanceType
	</query>
</hibernate-mapping>