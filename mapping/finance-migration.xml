<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
                "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping package="com.vimukti.accounter.core"
	default-access="field" auto-import="false">

	<query name="get.All.InventoryItem">
		<query-param name="companyId" type="long"/>
		from com.vimukti.accounter.core.Item it where it.company.id=:companyId and it.type in (2,4) 
	</query>

	<sql-query name="getNextAccountNumber">
		<query-param name="companyId" type="long" />
		<query-param name="subbaseType" type="int" />
		
		<return-scalar column="A_NUMBER" type="encryptedstring" />
		
		<![CDATA[
				SELECT A_NUMBER
				FROM   ACCOUNT A
				WHERE  SUB_BASE_TYPE = :subbaseType
				       AND A.COMPANY_ID = :companyId  
				]]>

	</sql-query> 
	
	<query name="get.AssetsAccountOfCompany">
		<query-param name="companyId" type="long"/>
		from com.vimukti.accounter.core.Account a where a.company.id=:companyId and a.type=5
	</query>
	
	<query name="get.Account.by.Name">
		<query-param name="companyId" type="long"/>
		<query-param name="accountName" type="String"/>
		from com.vimukti.accounter.core.Account a where a.name=:accountName and a.company.id=:companyId
	</query>
	
	<query name="getAccountTransactions">
		<query-param name="companyId" type="long"/>
		<query-param name="accountId" type="long"/>
		from com.vimukti.accounter.core.AccountTransaction at where at.account.id=:accountId and at.company.id=:companyId
	</query>
	
	<query name="get.AccountTransaction.Of.Item">
		<query-param name="itemId" type="long"/>
		select at from com.vimukti.accounter.core.AccountTransaction  at left join at.transaction.transactionItems as ti
		where ti.type=1 and ti.item.id=:itemId and 
		(at.account.id=ti.item.expenseAccount.id or at.account.id=ti.item.assestsAccount.id) and 
		(at.transaction.type in (1,14,8,37) or (at.transaction.type=36 and ti.quantity.value &lt; 0))
	</query>
	
	<sql-query name="delete.InventoryPurchases.Of.Company">
		<query-param name="companyId" type="long" />
		
		<![CDATA[
				DELETE FROM INVENTORY_PURCHASE IP
				USING  TRANSACTION_ITEM,
				       TRANSACTION
				WHERE  TRANSACTION_ITEM_ID = TRANSACTION_ITEM.ID
				       AND TRANSACTION_ITEM.TRANSACTION_ID = TRANSACTION.ID
				       AND TRANSACTION.COMPANY_ID = :companyId  
				]]>
		
	</sql-query>	
	
	<query name="get.AccountTransactions.Of.AccountReceivables">
		<query-param name="companyId" type="long" />
		from com.vimukti.accounter.core.AccountTransaction at 
		where at.account.id=at.company.accountsReceivableAccount.id and at.company.id=:companyId
	</query>
	
	<query name="get.AccountTransactions.Of.AccountPayables">
		<query-param name="companyId" type="long" />
		from com.vimukti.accounter.core.AccountTransaction at 
		where at.account.id=at.company.accountsPayableAccount.id and at.company.id=:companyId
	</query>
	
	<query name="getAllTransactionOfCompany">
		<query-param name="company" type="Company" />
		from com.vimukti.accounter.core.Transaction t  where t.company=:company
	</query>
	
	
	
</hibernate-mapping>